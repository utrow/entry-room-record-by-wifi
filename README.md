# entry-room-record-by-wifi
Wi-Fiで入退室の記録をつける

## 概要
個人の端末を判別する: MACアドレス

## 構築環境
- 無線LAN内の端末を監視するサーバ
  定期的にLAN内の端末を列挙、アプリケーションサーバへ接続端末(MACアドレス)を送信
- ユーザの端末登録や入退室記録を参照するためのAPサーバ
  DBで入退室情報を管理、入退室記録を参照できるようにする。

## 実装

### 無線LAN内の端末を監視するサーバ
Goで書きたい
- LAN内の端末を列挙: コマンドやライブラリ
- 接続端末の差分を求める
- 差分をアプリケーションサーバのAPIに投げる

端末登録時にIPに対応するMACアドレスを取得する
- 端末登録用のスモールなHTTPサーバを立てて、プライベートIPを取得。それを用いてMACアドレスと紐づける。

### APサーバ
Web系をベースにする。表示部分はすべてフロントでREST API叩いてJSONを処理させたい。
#### 構成要素
- DB
- REST API
- JSのフロント


#### 投げられた接続端末の差分をもとに入退室を記録
Slack通知もしたい
切断させてから1時間以上再接続がなければ、切断された日時を退出時間として安定化する。
滞在ユーザを管理して、個人で複数端末を接続してもうまくできるようにする。記録漏れ対策。

#### Google OAuthで認証

#### GitHubのコミットヒストリーみたいな視覚的なヒストリー
滞在時間で濃さ、列で曜日を把握できたら良さそう。

#### プライベートIPだったらログイン省略
IPに対応するMACアドレスを取得。さらにそのMACアドレスに紐づいたユーザでログインした状態にする。
セッションも持たせてしまえば、グローバルIPアクセス時もそのままログイン可能。

## 操作の流れ
とりあえず利便性の点から、ドメインを持ったAPサーバから基本操作する。

### APへアクセス
- LAN監視サーバと同じIPであれば、自動ログイン or 端末登録
- そうでなければ、ログインページの表示

#### 端末登録
- LAN監視サーバにHTTPアクセス
- HTTPのアクセスIP(192.168.xxx.xxx)と対応するMACアドレスを取得
- DBに登録トークンとMACアドレスを記録
- MACアドレスを返す。
- APサーバに登録トークンで登録ページにアクセスして、Google認証させて紐づける。SlackのIDも欲しい。


